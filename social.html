<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ ç¤¾äº¤è¶‹åŠ¿ - Daily Researcher</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .date-selector {
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .date-selector label {
            font-weight: 500;
            color: var(--primary-color);
        }
        .date-selector select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            background: white;
            min-width: 150px;
        }
        .current-badge {
            background: var(--success-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ¨ ç¤¾äº¤è¶‹åŠ¿</h1>
        <p>TikTok Â· Pinterest Â· Instagram Â· æ–‡åŒ–IPçƒ­ç‚¹</p>
        <p class="last-updated">æœ€åæ›´æ–°ï¼š<span id="update-time">åŠ è½½ä¸­...</span></p>
    </header>

    <nav>
        <a href="index.html">ä»ªè¡¨æ¿</a>
        <a href="competitor.html">ç«å“åŠ¨æ€</a>
        <a href="social.html" class="active">ç¤¾äº¤è¶‹åŠ¿</a>
        <a href="supply-chain.html">ä¾›åº”é“¾æœˆæŠ¥</a>
    </nav>

    <main>
        <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
        <div class="date-selector">
            <label>ğŸ“… é€‰æ‹©æ—¥æœŸï¼š</label>
            <select id="date-select" onchange="loadDataByDate()">
                <option value="">åŠ è½½ä¸­...</option>
            </select>
            <span class="current-badge" id="current-badge">åŠ è½½ä¸­...</span>
        </div>

        <!-- å¹³å°è¶‹åŠ¿ -->
        <section class="platforms">
            <div class="platform-card">
                <h3>ğŸµ TikTok çƒ­é—¨æ ‡ç­¾</h3>
                <div id="tiktok-tags" class="tag-list">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            <div class="platform-card">
                <h3>ğŸ“Œ Pinterest çƒ­é—¨</h3>
                <div id="pinterest-trends" class="trend-list">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            <div class="platform-card">
                <h3>ğŸ¬ YouTube çƒ­é—¨</h3>
                <div id="youtube-trends" class="trend-list">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
        </section>

        <!-- æ–‡åŒ–IPåˆä½œ -->
        <section class="ip-opportunities">
            <h3>ğŸ­ æ–‡åŒ–IPåˆä½œæœºä¼š</h3>
            <div id="ip-grid" class="ip-grid">
                <div style="padding: 1rem; text-align: center; color: #7f8c8d; grid-column: 1/-1;">
                    <span class="loading-spinner"></span> åŠ è½½ä¸­...
                </div>
            </div>
        </section>

        <!-- è®¾è®¡è¶‹åŠ¿ -->
        <section class="design-trends">
            <h3>ğŸ¨ è®¾è®¡è¶‹åŠ¿æ´å¯Ÿ</h3>
            <div class="trend-insights">
                <div class="trend-item">
                    <h4>ğŸŸ¤ è‰²å½©è¶‹åŠ¿</h4>
                    <div id="color-trends"></div>
                </div>
                <div class="trend-item">
                    <h4>ğŸŒ¿ ææ–™è¶‹åŠ¿</h4>
                    <div id="material-trends"></div>
                </div>
                <div class="trend-item">
                    <h4>âœ¨ é£æ ¼è¶‹åŠ¿</h4>
                    <div id="style-trends"></div>
                </div>
            </div>
        </section>

        <!-- ä¼ ç»Ÿå·¥è‰ºå»ºè®® -->
        <section class="craft-advice">
            <h3>ğŸ§µ ä¼ ç»Ÿå·¥è‰ºç»“åˆå»ºè®®</h3>
            <div id="craft-suggestions" class="suggestion-grid">
                <div style="padding: 1rem; text-align: center; color: #7f8c8d; grid-column: 1/-1;">
                    <span class="loading-spinner"></span> åŠ è½½ä¸­...
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>ğŸ“Š Daily Researcher | éé—æ‰‹å·¥å‡ºæµ·è¶‹åŠ¿æ´å¯Ÿ</p>
    </footer>

    <script>
    const Utils = {
        formatDate(date) {
            return new Date(date).toLocaleString('zh-CN', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit'
            });
        },
        formatNumber(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
    };

    let currentDate = new Date().toISOString().split('T')[0];
    let availableDates = [];

    // æ‰«æå¯ç”¨çš„æ—¥æœŸ
    async function scanAvailableDates() {
        try {
            const response = await fetch('data/social/');
            const text = await response.text();
            const matches = text.match(/2026-\d{2}-\d{2}/g);
            if (matches) {
                availableDates = [...new Set(matches)].sort().reverse();
            }
            
            if (availableDates.length === 0) {
                availableDates = ['2026-02-07', '2026-02-06', '2026-02-05', '2026-02-04'];
            }
            
            const select = document.getElementById('date-select');
            select.innerHTML = availableDates.map(date => {
                const cnDate = date.replace(/(\d{4})-(\d{2})-(\d{2})/, '$1å¹´$2æœˆ$3æ—¥');
                return `<option value="${date}">${cnDate}</option>`;
            }).join('');
            
            const today = new Date().toISOString().split('T')[0];
            currentDate = availableDates.includes(today) ? today : availableDates[0];
            
            document.getElementById('current-badge').textContent = 'æœ€æ–°æ•°æ®';
            document.getElementById('current-badge').style.background = '#27ae60';
            
            initPage();
        } catch (error) {
            console.error('Error scanning dates:', error);
            availableDates = ['2026-02-07', '2026-02-06', '2026-02-05', '2026-02-04'];
            const select = document.getElementById('date-select');
            select.innerHTML = availableDates.map(date => {
                const cnDate = date.replace(/(\d{4})-(\d{2})-(\d{2})/, '$1å¹´$2æœˆ$3æ—¥');
                return `<option value="${date}">${cnDate}</option>`;
            }).join('');
            currentDate = availableDates[0];
            initPage();
        }
    }

    async function loadDataByDate() {
        const select = document.getElementById('date-select');
        currentDate = select.value;
        
        const today = new Date().toISOString().split('T')[0];
        const badge = document.getElementById('current-badge');
        if (currentDate === today) {
            badge.textContent = 'æœ€æ–°æ•°æ®';
            badge.style.background = '#27ae60';
        } else {
            badge.textContent = 'å†å²æ•°æ®';
            badge.style.background = '#f39c12';
        }
        
        await initPage();
    }

    async function initPage() {
        console.log('ğŸš€ Social page initializing...', currentDate);
        document.getElementById('update-time').textContent = Utils.formatDate(new Date());
        
        try {
            let response = await fetch(`data/social/${currentDate}.json`);
            if (!response.ok) {
                if (availableDates.length > 1) {
                    currentDate = availableDates[0];
                    document.getElementById('date-select').value = currentDate;
                }
                response = await fetch(`data/social/${currentDate}.json`);
            }
            if (!response.ok) throw new Error('No data available');
            const data = await response.json();
            console.log('âœ… Data loaded:', data);
            
            // TikTokæ ‡ç­¾
            const tiktok = data.platformTrends?.find(p => p.platform === 'TikTok');
            if (tiktok?.topTags?.length > 0) {
                document.getElementById('tiktok-tags').innerHTML = tiktok.topTags.slice(0, 10).map(tag => `
                    <div class="product-item">
                        <span class="product-rank">#</span>
                        <div class="product-info">
                            <div class="product-name">${tag.name}</div>
                            <div class="product-meta">${Utils.formatNumber(tag.count || 0)} å¸–å­ Â· ${tag.engagement || 'ä¸­'}</div>
                        </div>
                        <span style="color: ${tag.trend === 'up' ? '#27ae60' : '#e74c3c'};">
                            ${tag.trend === 'up' ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${tag.weeklyChange || '0%'}
                        </span>
                    </div>
                `).join('');
            }
            
            // Pinterestè¶‹åŠ¿
            const pinterest = data.platformTrends?.find(p => p.platform === 'Pinterest');
            if (pinterest?.trendingPins?.length > 0) {
                document.getElementById('pinterest-trends').innerHTML = pinterest.trendingPins.slice(0, 8).map((pin, i) => `
                    <div class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${pin.title}</div>
                            <div class="product-meta">${pin.category} Â· ${pin.saveRate}ä¿å­˜ç‡</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // YouTubeè¶‹åŠ¿
            const youtube = data.platformTrends?.find(p => p.platform === 'YouTube');
            if (youtube?.trendingVideos?.length > 0) {
                document.getElementById('youtube-trends').innerHTML = youtube.trendingVideos.slice(0, 8).map((video, i) => `
                    <div class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${video.title}</div>
                            <div class="product-meta">${Utils.formatNumber(video.views || 0)}è§‚çœ‹ Â· ${video.duration || ''}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // IPåˆä½œæœºä¼š
            if (data.ipOpportunities?.length > 0) {
                const sortedIps = [...data.ipOpportunities].sort((a, b) => (a.priority || 99) - (b.priority || 99));
                document.getElementById('ip-grid').innerHTML = sortedIps.map(ip => `
                    <div class="ip-item">
                        <h4>${ip.icon} ${ip.name}</h4>
                        <p>${ip.category}</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.9;">${ip.suitability || ''}</p>
                    </div>
                `).join('');
            }
            
            // è‰²å½©è¶‹åŠ¿
            if (data.designTrends?.colors?.length > 0) {
                document.getElementById('color-trends').innerHTML = data.designTrends.colors.slice(0, 5).map(color => `
                    <div class="price-item" style="background: ${color.hex || '#ccc'}; color: white;">
                        <div class="price-name">${color.name || 'æœªçŸ¥'}</div>
                        <div class="price-value">${color.hex || ''}</div>
                    </div>
                `).join('');
            }
            
            // ææ–™è¶‹åŠ¿
            if (data.designTrends?.materials?.length > 0) {
                document.getElementById('material-trends').innerHTML = data.designTrends.materials.map((m, i) => `
                    <div class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${m.name || 'æœªçŸ¥'}</div>
                            <div class="product-meta">${m.applications || ''}</div>
                        </div>
                        <span style="color: ${m.trend === 'up' ? '#27ae60' : '#e74c3c'};">
                            +${m.growth || 0}%
                        </span>
                    </div>
                `).join('');
            }
            
            // é£æ ¼è¶‹åŠ¿
            if (data.designTrends?.styles?.length > 0) {
                document.getElementById('style-trends').innerHTML = data.designTrends.styles.slice(0, 6).map((s, i) => `
                    <div class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${s.name || 'æœªçŸ¥'}</div>
                            <div class="product-meta">${s.description || ''}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // å·¥è‰ºå»ºè®®
            if (data.craftSuggestions?.length > 0) {
                document.getElementById('craft-suggestions').innerHTML = data.craftSuggestions.map(s => `
                    <div class="suggestion-item">
                        <h4>${s.icon || 'ğŸ“¦'} ${s.craft || 'æœªçŸ¥'}</h4>
                        <p><strong>æ–¹å‘ï¼š</strong>${s.direction || ''}</p>
                        <p><strong>ç›®æ ‡ï¼š</strong>${s.targetAudience || ''}</p>
                        <p style="font-size: 0.8rem; color: #27ae60; margin-top: 0.5rem;">ä¼˜å…ˆçº§: ${s.priority || 'ä¸­'}</p>
                    </div>
                `).join('');
            }
            
            console.log('âœ… Social page rendered');
        } catch (error) {
            console.error('âŒ Error:', error);
            const ids = ['tiktok-tags', 'pinterest-trends', 'youtube-trends', 'craft-suggestions'];
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = '<div style="padding: 1rem; color: #e74c3c;">æ•°æ®åŠ è½½å¤±è´¥</div>';
            });
        }
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', scanAvailableDates);
    } else {
        scanAvailableDates();
    }
    </script>
</body>
</html>
