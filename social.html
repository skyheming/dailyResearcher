<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ ç¤¾äº¤è¶‹åŠ¿ - Daily Researcher</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading-spinner {display:inline-block;width:20px;height:20px;border:2px solid #f3f3f3;border-top:2px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin {0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        .date-selector {background:white;padding:1rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 10px rgba(0,0,0,0.1);display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
        .date-selector select {padding:0.5rem 1rem;border:2px solid #3498db;border-radius:8px;font-size:1rem;cursor:pointer;background:white;min-width:150px}
        .current-badge {background:#27ae60;color:white;padding:0.3rem 0.8rem;border-radius:20px;font-size:0.8rem;margin-left:auto}
    </style>
</head>
<body>
    <header>
        <h1>ğŸ¨ ç¤¾äº¤è¶‹åŠ¿</h1>
        <p>TikTok Â· Pinterest Â· æ–‡åŒ–IPçƒ­ç‚¹</p>
        <p class="last-updated">æœ€åæ›´æ–°ï¼š<span id="update-time">åŠ è½½ä¸­...</span></p>
    </header>
    <nav>
        <a href="index.html">ä»ªè¡¨æ¿</a>
        <a href="competitor.html">ç«å“åŠ¨æ€</a>
        <a href="social.html" class="active">ç¤¾äº¤è¶‹åŠ¿</a>
        <a href="supply-chain.html">ä¾›åº”é“¾æœˆæŠ¥</a>
    </nav>
    <main>
        <div class="date-selector">
            <label>ğŸ“… é€‰æ‹©æ—¥æœŸï¼š</label>
            <select id="date-select" onchange="loadDataByDate()"><option value="">åŠ è½½ä¸­...</option></select>
            <span class="current-badge" id="current-badge">åŠ è½½ä¸­...</span>
        </div>
        <section class="platforms">
            <div class="platform-card"><h3>ğŸµ TikTok çƒ­é—¨æ ‡ç­¾</h3><div id="tiktok-tags" class="tag-list"><div style="padding:1rem;text-align:center;color:#7f8c8d"><span class="loading-spinner"></span>åŠ è½½ä¸­...</div></div></div>
            <div class="platform-card"><h3>ğŸ“Œ Pinterest çƒ­é—¨</h3><div id="pinterest-trends" class="trend-list"><div style="padding:1rem;text-align:center;color:#7f8c8d"><span class="loading-spinner"></span>åŠ è½½ä¸­...</div></div></div>
            <div class="platform-card"><h3>ğŸ¬ YouTube çƒ­é—¨</h3><div id="youtube-trends" class="trend-list"><div style="padding:1rem;text-align:center;color:#7f8c8d"><span class="loading-spinner"></span>åŠ è½½ä¸­...</div></div></div>
        </section>
        <section class="ip-opportunities"><h3>ğŸ­ æ–‡åŒ–IPåˆä½œæœºä¼š</h3><div id="ip-grid" class="ip-grid"><div style="padding:1rem;text-align:center;color:#7f8c8d;grid-column:1/-1"><span class="loading-spinner"></span>åŠ è½½ä¸­...</div></div></section>
        <section class="craft-advice"><h3>ğŸ§µ ä¼ ç»Ÿå·¥è‰ºç»“åˆå»ºè®®</h3><div id="craft-suggestions" class="suggestion-grid"><div style="padding:1rem;text-align:center;color:#7f8c8d;grid-column:1/-1"><span class="loading-spinner"></span>åŠ è½½ä¸­...</div></div></section>
    </main>
    <footer><p>ğŸ“Š Daily Researcher | éé—æ‰‹å·¥å‡ºæµ·è¶‹åŠ¿æ´å¯Ÿ</p></footer>
    <script>
    // å·¥å…·å‡½æ•°
    function formatDate(date) {
        return new Date(date).toLocaleString('zh-CN', {year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    }
    function formatNumber(num) {
        if(num>=1000000000) return (num/1000000000).toFixed(1)+'B';
        if(num>=1000000) return (num/1000000).toFixed(1)+'M';
        if(num>=1000) return (num/1000).toFixed(1)+'K';
        return num.toString();
    }

    // å…¨å±€å˜é‡
    var currentDate = new Date().toISOString().split('T')[0];
    var availableDates = [];

    // é¢„å®šä¹‰æœ€è¿‘30å¤©çš„æ—¥æœŸåˆ—è¡¨
    function getRecentDates() {
        var dates = [];
        for(var i=0; i<30; i++) {
            var d = new Date();
            d.setDate(d.getDate() - i);
            dates.push(d.toISOString().split('T')[0]);
        }
        return dates;
    }

    // æ‰«æå¯ç”¨æ—¥æœŸ
    function scanDates() {
        var recentDates = getRecentDates();
        var promises = recentDates.map(function(d) {
            return fetch('data/social/'+d+'.json')
                .then(function(r) { return r.ok ? d : null; })
                .catch(function() { return null; });
        });

        Promise.all(promises).then(function(results) {
            availableDates = results.filter(function(d) { return d !== null; });
            if(availableDates.length === 0) {
                availableDates = ['2026-02-07','2026-02-06','2026-02-05','2026-02-04'];
            }
            availableDates.sort().reverse();

            var select = document.getElementById('date-select');
            select.innerHTML = '';
            availableDates.forEach(function(d) {
                var opt = document.createElement('option');
                opt.value = d;
                opt.textContent = d.replace(/(\d{4})-(\d{2})-(\d{2})/, '$1å¹´$2æœˆ$3æ—¥');
                select.appendChild(opt);
            });

            var today = new Date().toISOString().split('T')[0];
            currentDate = availableDates.includes(today) ? today : availableDates[0];
            select.value = currentDate;

            document.getElementById('current-badge').textContent = 'æœ€æ–°æ•°æ®';
            initPage();
        });
    }

    function loadDataByDate() {
        var select = document.getElementById('date-select');
        currentDate = select.value;
        var today = new Date().toISOString().split('T')[0];
        var badge = document.getElementById('current-badge');
        badge.textContent = currentDate === today ? 'æœ€æ–°æ•°æ®' : 'å†å²æ•°æ®';
        badge.style.background = currentDate === today ? '#27ae60' : '#f39c12';
        initPage();
    }

    function initPage() {
        console.log('Social page init', currentDate);
        document.getElementById('update-time').textContent = formatDate(new Date());

        fetch('data/social/'+currentDate+'.json')
            .then(function(r) {
                if(!r.ok) throw new Error('No data');
                return r.json();
            })
            .then(function(data) {
                console.log('Data loaded', data);

                var tiktok = data.platformTrends ? data.platformTrends.find(function(p) { return p.platform === 'TikTok'; }) : null;
                if(tiktok && tiktok.topTags) {
                    document.getElementById('tiktok-tags').innerHTML = tiktok.topTags.slice(0,10).map(function(tag) {
                        return '<div class="product-item"><span class="product-rank">#</span>'+
                            '<div class="product-info"><div class="product-name">'+tag.name+'</div>'+
                            '<div class="product-meta">'+formatNumber(tag.count||0)+'å¸–å­ Â· '+(tag.engagement||'ä¸­')+'</div></div>'+
                            '<span style="color:'+(tag.trend==='up'?'#27ae60':'#e74c3c')+'">'+
                            (tag.trend==='up'?'ğŸ“ˆ':'ğŸ“‰')+' '+(tag.weeklyChange||'0%')+'</span></div>';
                    }).join('');
                }

                var pinterest = data.platformTrends ? data.platformTrends.find(function(p) { return p.platform === 'Pinterest'; }) : null;
                if(pinterest && pinterest.trendingPins) {
                    document.getElementById('pinterest-trends').innerHTML = pinterest.trendingPins.slice(0,8).map(function(pin, i) {
                        return '<div class="product-item"><span class="product-rank">'+(i+1)+'</span>'+
                            '<div class="product-info"><div class="product-name">'+pin.title+'</div>'+
                            '<div class="product-meta">'+pin.category+' Â· '+pin.saveRate+'ä¿å­˜ç‡</div></div></div>';
                    }).join('');
                }

                var youtube = data.platformTrends ? data.platformTrends.find(function(p) { return p.platform === 'YouTube'; }) : null;
                if(youtube && youtube.trendingVideos) {
                    document.getElementById('youtube-trends').innerHTML = youtube.trendingVideos.slice(0,8).map(function(v, i) {
                        return '<div class="product-item"><span class="product-rank">'+(i+1)+'</span>'+
                            '<div class="product-info"><div class="product-name">'+v.title+'</div>'+
                            '<div class="product-meta">'+formatNumber(v.views||0)+'è§‚çœ‹ Â· '+(v.duration||'')+'</div></div></div>';
                    }).join('');
                }

                if(data.ipOpportunities && data.ipOpportunities.length > 0) {
                    var sortedIps = data.ipOpportunities.sort(function(a, b) { return (a.priority||99) - (b.priority||99); });
                    document.getElementById('ip-grid').innerHTML = sortedIps.map(function(ip) {
                        return '<div class="ip-item"><h4>'+ip.icon+' '+ip.name+'</h4>'+
                            '<p>'+ip.category+'</p>'+
                            '<p style="font-size:0.8rem;margin-top:0.5rem;opacity:0.9">'+(ip.suitability||'')+'</p></div>';
                    }).join('');
                }

                if(data.craftSuggestions && data.craftSuggestions.length > 0) {
                    document.getElementById('craft-suggestions').innerHTML = data.craftSuggestions.map(function(s) {
                        return '<div class="suggestion-item"><h4>'+(s.icon||'ğŸ“¦')+' '+s.craft+'</h4>'+
                            '<p><strong>æ–¹å‘ï¼š</strong>'+(s.direction||'')+'</p>'+
                            '<p><strong>ç›®æ ‡ï¼š</strong>'+(s.targetAudience||'')+'</p>'+
                            '<p style="font-size:0.8rem;color:#27ae60;margin-top:0.5rem">ä¼˜å…ˆçº§: '+(s.priority||'ä¸­')+'</p></div>';
                    }).join('');
                }

                console.log('Page rendered');
            })
            .catch(function(e) {
                console.error('Error', e);
                ['tiktok-tags','pinterest-trends','youtube-trends','craft-suggestions'].forEach(function(id) {
                    var el = document.getElementById(id);
                    if(el) el.innerHTML = '<div style="padding:1rem;color:#e74c3c">æ•°æ®åŠ è½½å¤±è´¥</div>';
                });
            });
    }

    if(document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', scanDates);
    } else {
        scanDates();
    }
    </script>
</body>
</html>
