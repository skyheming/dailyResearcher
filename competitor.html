<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›’ ç«å“åŠ¨æ€ - Daily Researcher</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .date-selector {
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .date-selector label {
            font-weight: 500;
            color: var(--primary-color);
        }
        .date-selector select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            background: white;
        }
        .current-badge {
            background: var(--success-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ›’ ç«å“åŠ¨æ€</h1>
        <p>Amazon Â· Etsy Â· TikTok Shop å…¨çƒç”µå•†çƒ­é”€åˆ†æ</p>
        <p class="last-updated">æœ€åæ›´æ–°ï¼š<span id="update-time">åŠ è½½ä¸­...</span></p>
    </header>

    <nav>
        <a href="index.html">ä»ªè¡¨æ¿</a>
        <a href="competitor.html" class="active">ç«å“åŠ¨æ€</a>
        <a href="social.html">ç¤¾äº¤è¶‹åŠ¿</a>
        <a href="supply-chain.html">ä¾›åº”é“¾æœˆæŠ¥</a>
    </nav>

    <main>
        <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
        <div class="date-selector">
            <label>ğŸ“… é€‰æ‹©æ—¥æœŸï¼š</label>
            <select id="date-select" onchange="loadDataByDate()">
                <option value="2026-02-05">2026å¹´2æœˆ5æ—¥</option>
                <option value="2026-02-04">2026å¹´2æœˆ4æ—¥</option>
            </select>
            <span class="current-badge" id="current-badge">æœ€æ–°æ•°æ®</span>
        </div>

        <!-- å¹³å°æ¦‚è§ˆ -->
        <section class="platforms">
            <div class="platform-card">
                <h3>ğŸ›ï¸ Amazon Top 10</h3>
                <div id="amazon-list" class="product-list">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            <div class="platform-card">
                <h3>ğŸ¨ Etsy çƒ­é”€æ¦œ</h3>
                <div id="etsy-list" class="product-list">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            <div class="platform-card">
                <h3>ğŸ“± TikTok Shop çˆ†æ¬¾</h3>
                <div id="tiktok-list" class="product-list">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
        </section>

        <!-- è¶‹åŠ¿æ´å¯Ÿ -->
        <section class="insights">
            <div class="insight-card">
                <h3>ğŸ’° ä»·æ ¼å¸¦åˆ†å¸ƒ</h3>
                <div id="price-distribution" style="height: 250px; position: relative;">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            <div class="insight-card">
                <h3>ğŸ¯ å“ç±»çƒ­åº¦æ’è¡Œ</h3>
                <div id="category-rankings">
                    <div style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
        </section>

        <!-- ä¸­å›½ä¾›åº”é“¾ä¼˜åŠ¿ -->
        <section class="opportunities">
            <h3>ğŸ‡¨ğŸ‡³ ä¸­å›½ä¾›åº”é“¾ä¼˜åŠ¿å“ç±»</h3>
            <div id="china-opportunities" class="opportunity-grid">
                <div style="padding: 1rem; text-align: center; color: #7f8c8d; grid-column: 1/-1;">
                    <span class="loading-spinner"></span> åŠ è½½ä¸­...
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>ğŸ“Š Daily Researcher | éé—æ‰‹å·¥å‡ºæµ·è¶‹åŠ¿æ´å¯Ÿ</p>
    </footer>

    <script>
    const Utils = {
        formatDate(date) {
            return new Date(date).toLocaleString('zh-CN', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit'
            });
        },
        formatNumber(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
    };

    let currentDate = new Date().toISOString().split('T')[0];

    async function loadDataByDate() {
        const select = document.getElementById('date-select');
        currentDate = select.value;
        
        const badge = document.getElementById('current-badge');
        const today = new Date().toISOString().split('T')[0];
        if (currentDate === today) {
            badge.textContent = 'æœ€æ–°æ•°æ®';
            badge.style.background = '#27ae60';
        } else {
            badge.textContent = 'å†å²æ•°æ®';
            badge.style.background = '#f39c12';
        }
        
        await initPage();
    }

    async function initPage() {
        console.log('ğŸš€ Competitor page initializing...', currentDate);
        document.getElementById('update-time').textContent = Utils.formatDate(new Date());
        
        try {
            const response = await fetch(`data/competitor/${currentDate}.json`);
            let data;
            if (!response.ok) {
                const latestResponse = await fetch('data/competitor/2026-02-05.json');
                if (!latestResponse.ok) throw new Error('No data available');
                data = await latestResponse.json();
            } else {
                data = await response.json();
            }
            console.log('âœ… Data loaded:', data);
            
            // Amazonåˆ—è¡¨
            if (data.amazonTop && data.amazonTop.length > 0) {
                document.getElementById('amazon-list').innerHTML = data.amazonTop.slice(0, 10).map((p, i) => `
                    <div class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-meta">${p.category} Â· ${p.source || 'Amazon'}</div>
                        </div>
                        <span class="product-price">${p.price}</span>
                    </div>
                `).join('');
            }
            
            // Etsyåˆ—è¡¨
            if (data.etsyTop && data.etsyTop.length > 0) {
                document.getElementById('etsy-list').innerHTML = data.etsyTop.slice(0, 10).map((p, i) => `
                    <div class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-meta">${p.category} Â· ${p.note || ''}</div>
                        </div>
                        <span class="product-price">${p.price}</span>
                    </div>
                `).join('');
            }
            
            // TikTokåˆ—è¡¨
            if (data.tiktokShop && data.tiktokShop.length > 0) {
                document.getElementById('tiktok-list').innerHTML = data.tiktokShop.slice(0, 10).map((p, i) => `
                    <div class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-meta">#${p.hashtag} Â· ${Utils.formatNumber(p.views)}æ’­æ”¾</div>
                        </div>
                        <span class="product-price">${p.price}</span>
                    </div>
                `).join('');
            }
            
            // ä»·æ ¼åˆ†å¸ƒå›¾è¡¨
            if (data.priceDistribution) {
                const ctx = document.getElementById('price-distribution');
                ctx.innerHTML = '<canvas id="priceChart"></canvas>';
                new Chart(ctx.querySelector('#priceChart'), {
                    type: 'doughnut',
                    data: {
                        labels: data.priceDistribution.labels,
                        datasets: [{
                            data: data.priceDistribution.data,
                            backgroundColor: ['#3498db','#e74c3c','#27ae60','#f39c12','#9b59b6'],
                            borderWidth: 2, borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'right' } }
                    }
                });
            }
            
            // å“ç±»æ’è¡Œ
            if (data.categoryRankings && data.categoryRankings.length > 0) {
                document.getElementById('category-rankings').innerHTML = `
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--bg-color);">
                                <th style="padding: 8px; text-align: left;">æ’å</th>
                                <th style="padding: 8px; text-align: left;">å“ç±»</th>
                                <th style="padding: 8px; text-align: right;">å¢é•¿ç‡</th>
                                <th style="padding: 8px; text-align: right;">æ¯›åˆ©ç‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.categoryRankings.map((item, i) => `
                                <tr style="border-bottom: 1px solid #eee;">
                                    <td style="padding: 8px; width: 40px;">${i+1}</td>
                                    <td style="padding: 8px;">${item.name}</td>
                                    <td style="padding: 8px; text-align: right; color: #27ae60;">+${item.growth}%</td>
                                    <td style="padding: 8px; text-align: right; color: #3498db;">${item.margin}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            console.log('âœ… Competitor page rendered');
        } catch (error) {
            console.error('âŒ Error:', error);
            const ids = ['amazon-list', 'etsy-list', 'tiktok-list', 'china-opportunities'];
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = '<div style="padding: 1rem; color: #e74c3c;">æ•°æ®åŠ è½½å¤±è´¥</div>';
            });
        }
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initPage);
    } else {
        initPage();
    }
    </script>
</body>
</html>
