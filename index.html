<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Daily Researcher - éé—æ‰‹å·¥å‡ºæµ·å…¨çƒè¶‹åŠ¿æ´å¯Ÿ</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .date-selector {
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .date-selector label {
            font-weight: 500;
            color: var(--primary-color);
        }
        .date-selector select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            background: white;
        }
        .date-selector select:hover {
            background: var(--bg-color);
        }
        .current-badge {
            background: var(--success-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ“Š Daily Researcher</h1>
        <p>éé—æ‰‹å·¥å‡ºæµ· Â· å…¨çƒè¶‹åŠ¿æ´å¯Ÿä»ªè¡¨æ¿</p>
        <p class="last-updated">æœ€åæ›´æ–°ï¼š<span id="update-time">åŠ è½½ä¸­...</span></p>
    </header>

    <nav>
        <a href="index.html" class="active">ä»ªè¡¨æ¿</a>
        <a href="competitor.html">ç«å“åŠ¨æ€</a>
        <a href="social.html">ç¤¾äº¤è¶‹åŠ¿</a>
        <a href="supply-chain.html">ä¾›åº”é“¾æœˆæŠ¥</a>
    </nav>

    <main>
        <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
        <div class="date-selector">
            <label>ğŸ“… é€‰æ‹©æ—¥æœŸï¼š</label>
            <select id="date-select" onchange="loadDataByDate()">
                <option value="2026-02-05">2026å¹´2æœˆ5æ—¥</option>
                <option value="2026-02-04">2026å¹´2æœˆ4æ—¥</option>
            </select>
            <span class="current-badge" id="current-badge">æœ€æ–°æ•°æ®</span>
        </div>

        <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
        <section class="metrics">
            <div class="metric-card">
                <h3>ğŸ”¥ ä»Šæ—¥çƒ­ç‚¹</h3>
                <ul id="hot-topics">
                    <li style="padding: 1rem; text-align: center; color: #7f8c8d;">
                        <span class="loading-spinner"></span> åŠ è½½ä¸­...
                    </li>
                </ul>
            </div>
            <div class="metric-card">
                <h3>ğŸ·ï¸ çƒ­é—¨æ ‡ç­¾</h3>
                <div id="tag-cloud" class="tag-cloud" style="padding: 1rem; text-align: center; color: #7f8c8d;">
                    <span class="loading-spinner"></span> åŠ è½½ä¸­...
                </div>
            </div>
        </section>

        <!-- è¶‹åŠ¿å›¾è¡¨ -->
        <section class="charts">
            <div class="chart-container">
                <h3>ğŸ“ˆ è¶‹åŠ¿çƒ­åº¦å˜åŒ–</h3>
                <canvas id="trendChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>ğŸ¥§ å“ç±»åˆ†å¸ƒ</h3>
                <canvas id="categoryChart"></canvas>
            </div>
        </section>

        <!-- å¿«é€Ÿé“¾æ¥ -->
        <section class="quick-links">
            <h3>ğŸ“± å¿«é€ŸæŸ¥çœ‹</h3>
            <div class="link-cards">
                <a href="competitor.html" class="link-card">
                    <span class="icon">ğŸ›’</span>
                    <span class="title">ç«å“åŠ¨æ€</span>
                    <span class="desc">Amazon/Etsy/TikTok Shopçƒ­é”€åˆ†æ</span>
                </a>
                <a href="social.html" class="link-card">
                    <span class="icon">ğŸ¨</span>
                    <span class="title">ç¤¾äº¤è¶‹åŠ¿</span>
                    <span class="desc">TikTok/Pinterest/æ–‡åŒ–IPçƒ­ç‚¹</span>
                </a>
                <a href="supply-chain.html" class="link-card">
                    <span class="icon">ğŸ“¦</span>
                    <span class="title">ä¾›åº”é“¾æœˆæŠ¥</span>
                    <span class="desc">å…¨å›½äº§åŒº/åŸææ–™/æ”¿ç­–ä¿¡æ¯</span>
                </a>
            </div>
        </section>
    </main>

    <footer>
        <p>ğŸ“Š Daily Researcher | éé—æ‰‹å·¥å‡ºæµ·è¶‹åŠ¿æ´å¯Ÿ</p>
        <p>æ•°æ®æ¥æºï¼šAmazon, Etsy, TikTok Shop, Pinterest, Google Trends</p>
    </footer>

    <script>
    // å·¥å…·å‡½æ•°
    const Utils = {
        formatDate(date) {
            return new Date(date).toLocaleString('zh-CN', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit'
            });
        },
        formatNumber(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        },
        getTagSize(count, maxCount) {
            const ratio = count / maxCount;
            if (ratio > 0.8) return 'size-5';
            if (ratio > 0.6) return 'size-4';
            if (ratio > 0.4) return 'size-3';
            if (ratio > 0.2) return 'size-2';
            return 'size-1';
        }
    };

    // å›¾è¡¨å·¥å…·
    const ChartUtils = {
        createLineChart(ctx, labels, datasets) {
            return new Chart(ctx, {
                type: 'line',
                data: { labels, datasets: datasets.map((d, i) => ({
                    label: d.label, data: d.data,
                    borderColor: ['#3498db','#e74c3c','#27ae60'][i%3],
                    backgroundColor: 'transparent', tension: 0.4, fill: false
                }))},
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: false } }
                }
            });
        },
        createPieChart(ctx, labels, data) {
            return new Chart(ctx, {
                type: 'doughnut',
                data: { labels, datasets: [{
                    data, borderWidth: 2, borderColor: '#fff',
                    backgroundColor: ['#3498db','#e74c3c','#27ae60','#f39c12','#9b59b6','#1abc9c']
                }]},
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'right' } }
                }
            });
        }
    };

    // å½“å‰é€‰ä¸­çš„æ—¥æœŸ
    let currentDate = new Date().toISOString().split('T')[0];
    
    // åŠ è½½æŒ‡å®šæ—¥æœŸçš„æ•°æ®
    async function loadDataByDate() {
        const select = document.getElementById('date-select');
        currentDate = select.value;
        
        // æ›´æ–°æœ€æ–°æ ‡è¯†
        const today = new Date().toISOString().split('T')[0];
        const badge = document.getElementById('current-badge');
        if (currentDate === today) {
            badge.textContent = 'æœ€æ–°æ•°æ®';
            badge.style.background = '#27ae60';
        } else {
            badge.textContent = 'å†å²æ•°æ®';
            badge.style.background = '#f39c12';
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        document.getElementById('hot-topics').innerHTML = 
            '<li style="padding: 1rem; text-align: center;"><span class="loading-spinner"></span> åŠ è½½ä¸­...</li>';
        document.getElementById('tag-cloud').innerHTML = 
            '<span style="color: #7f8c8d;"><span class="loading-spinner"></span> åŠ è½½ä¸­...</span>';
        
        await initDashboard();
    }

    // ä¸»é€»è¾‘
    async function initDashboard() {
        console.log('ğŸš€ Dashboard initializing...', currentDate);
        document.getElementById('update-time').textContent = Utils.formatDate(new Date());
        
        try {
            const response = await fetch(`data/competitor/${currentDate}.json`);
            if (!response.ok) {
                // å¦‚æœæŒ‡å®šæ—¥æœŸæ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨æœ€æ–°æ•°æ®
                const latestResponse = await fetch('data/competitor/2026-02-05.json');
                if (!latestResponse.ok) throw new Error('No data available');
                var data = await latestResponse.json();
                console.log('âœ… Using latest data:', data);
            } else {
                var data = await response.json();
                console.log('âœ… Data loaded:', data);
            }
            
            // æ¸²æŸ“ä»Šæ—¥çƒ­ç‚¹
            const hotContainer = document.getElementById('hot-topics');
            if (data.hotProducts && data.hotProducts.length > 0) {
                hotContainer.innerHTML = data.hotProducts.slice(0, 5).map((p, i) => `
                    <li class="product-item">
                        <span class="product-rank">${i+1}</span>
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-meta">${p.platform} Â· ${p.price}</div>
                        </div>
                        <span class="product-price">${p.sales}</span>
                    </li>
                `).join('');
            } else {
                hotContainer.innerHTML = '<li style="padding: 1rem; color: #7f8c8d;">æš‚æ— æ•°æ®</li>';
            }
            
            // æ¸²æŸ“æ ‡ç­¾äº‘
            const tagContainer = document.getElementById('tag-cloud');
            if (data.trendingTags && data.trendingTags.length > 0) {
                const maxCount = Math.max(...data.trendingTags.slice(0, 15).map(t => t.count || 1));
                tagContainer.innerHTML = data.trendingTags.slice(0, 15).map(tag => `
                    <span class="tag ${Utils.getTagSize(tag.count || 1, maxCount)}">
                        ${tag.name}
                    </span>
                `).join('');
            } else {
                tagContainer.innerHTML = '<span style="color: #7f8c8d;">æš‚æ— æ ‡ç­¾æ•°æ®</span>';
            }
            
            // æ¸²æŸ“è¶‹åŠ¿å›¾è¡¨
            if (data.trendData) {
                const trendCtx = document.getElementById('trendChart').getContext('2d');
                ChartUtils.createLineChart(trendCtx, data.trendData.labels, data.trendData.datasets);
            }
            
            // æ¸²æŸ“å“ç±»åˆ†å¸ƒ
            if (data.categoryDistribution) {
                const catCtx = document.getElementById('categoryChart').getContext('2d');
                ChartUtils.createPieChart(catCtx, data.categoryDistribution.labels, data.categoryDistribution.data);
            }
            
            console.log('âœ… Dashboard rendered successfully');
        } catch (error) {
            console.error('âŒ Error:', error);
            document.getElementById('hot-topics').innerHTML = 
                '<li style="padding: 1rem; color: #e74c3c;">æ•°æ®åŠ è½½å¤±è´¥</li>';
            document.getElementById('tag-cloud').innerHTML = 
                '<span style="color: #e74c3c;">æ•°æ®åŠ è½½å¤±è´¥</span>';
        }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initDashboard);
    } else {
        initDashboard();
    }
    </script>
</body>
</html>
